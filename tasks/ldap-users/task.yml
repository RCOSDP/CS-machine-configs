- name: ensure ldap-users work dir exists
  file:
    name: /tmp/ldap-users
    state: directory
#
# copy group csv file to the remote host
#
- name: copy vars/ldap_groups.csv
  copy:
    src: vars/ldap_groups.csv
    dest: /tmp/ldap-users/ldap_groups.csv

#
# copy user csv file to the remote host
# NOTE: plain pw column in the csv file
# is actually unncessary (retained for
# convenience)
#
- name: copy vars/ldap_users.csv
  copy:
    src: vars/ldap_users.csv
    dest: /tmp/ldap-users/ldap_users.csv

#    
# copy python script that does everything
#
- name: copy make_users_groups.py
  copy:
    src: make_users_groups.py
    dest: /tmp/ldap-users/make_users_groups.py
    mode: "0755"

#    
# and execute it
#
- name: make users and groups
  command:
    cmd: ./make_users_groups.py {{ldap_domain_password}} {{ldap_domain}} --users ldap_users.csv --groups ldap_groups.csv
    chdir: /tmp/ldap-users

